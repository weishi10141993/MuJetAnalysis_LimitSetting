import math
from math import *

def fCmsLimitVsM(m):
  #M = 0.315
  #LimitMin = 3.08
  #LimitMax = 8.55
  #if False:
  #  print "M = ", M
  #  print "LimitMin = ", LimitMin
  #  print "LimitMax = ", LimitMax
  #  print "sigma = ", fCmsResolution(M)
  #  print "myGaus(M, M, fCmsResolution(M) ) = ", myGaus(M, M, fCmsResolution(M) )
  #  print "LimitMax-LimitMin/myGaus[M,M,sigma(M)]/sigma(M)sqrt(2pi) = ", (LimitMax - LimitMin)/myGaus(M, M, fCmsResolution(M) )/fCmsResolution(M)/sqrt(2.0*pi)
  #  print "1/2/sigma(M)^2 = ", 1.0/2.0/fCmsResolution(M)/fCmsResolution(M)
  #  print "Err: " + str(LimitMin + (LimitMax - LimitMin)*myGaus(m, M, fCmsResolution(M) )/myGaus(M, M, fCmsResolution(M) ))
  #return LimitMin + (LimitMax - LimitMin)*myGaus(m, M, fCmsResolution(M) )/myGaus(M, M, fCmsResolution(M) )
#****************************************
# old method 95 CL v2
  return 3.205 + \
0.14*exp(-0.5*((m-0.568278)/0.0809449)**2) + \
1.80706*exp(-0.5*((m-0.832)/0.035)**2) + \
0.74807*exp(-0.5*((m-1.18349)/0.0330001)**2) + \
1.8*exp(-0.5*((m-1.41324)/0.034)**2) + \
0.638387*exp(-0.5*((m-1.9109)/0.0500741)**2) + \
1.20542*exp(-0.5*((m-2.37377)/0.04)**2) + \
1.45*exp(-0.5*((m-2.9989)/0.160763)**2) + \
5.0654*exp(-0.5*((m-3.11577)/0.128669)**2)
# old method 95 CL
#  return 3.175 + \
#0.231692*exp(-0.5*((m-0.556259)/0.0997077)**2) + \
#2.28*exp(-0.5*((m-0.916552)/0.032)**2) + \
#2.1*exp(-0.5*((m-1.16447)/0.02)**2) + \
#2.25*exp(-0.5*((m-1.41355)/0.035)**2) + \
#3.0*exp(-0.5*((m-1.90464)/0.0777818)**2) + \
#1.8*exp(-0.5*((m-2.39079)/0.0469897)**2) + \
#0.685263*exp(-0.5*((m-2.74387)/0.04)**2) + \
#4.7*exp(-0.5*((m-3.10271)/0.0942601)**2)

#90CL v2
#  return 2.4 + \
#0.196258*exp(-0.5*((m-0.585342)/0.0400199)**2) + \
#1.32241*exp(-0.5*((m-0.833146)/0.0350001)**2) + \
#0.893637*exp(-0.5*((m-1.16449)/0.033)**2) + \
#1.79953*exp(-0.5*((m-1.41323)/0.03)**2) + \
#0.59907*exp(-0.5*((m-1.90641)/0.05)**2) + \
#1.1*exp(-0.5*((m-2.40133)/0.042)**2) + \
#2.20401*exp(-0.5*((m-2.999)/0.169458)**2) + \
#3.57*exp(-0.5*((m-3.1005)/0.134076)**2)

#90CL v1
#  return (3.175 + \
#0.231692*exp(-0.5*((m-0.556259)/0.0997077)**2) + \
#2.28*exp(-0.5*((m-0.916552)/0.032)**2) + \
#2.1*exp(-0.5*((m-1.16447)/0.02)**2) + \
#2.25*exp(-0.5*((m-1.41355)/0.035)**2) + \
#3.0*exp(-0.5*((m-1.90464)/0.0777818)**2) + \
#1.8*exp(-0.5*((m-2.39079)/0.0469897)**2) + \
#0.685263*exp(-0.5*((m-2.74387)/0.05)**2) + \
#5.5*exp(-0.5*((m-3.10271)/0.085)**2) ) * 0.7419354838710

def fCmsLimitVsM_explicit(m):
  A = 3.082
  B = 1.18
  C = 552.0
  M = 0.315
  return A + B*exp( -552*(m - M)*(m - M) )

def myGaus(x, mu, sigma):
  return 1/( sigma * sqrt(2.0*pi) ) * exp( - (x - mu)*(x - mu) / 2.0/sigma/sigma )

def fCmsResolution ( m ):
  return (0.13 + m*0.065)/5.0

def fCmsLimitVsM_HybridNew(m): # return the limit for a given mass. If the mass point is not present, it makes an interpolation.
  if m >= 0.2113 and m <= 8.55:
    m_im1 = 0.2113
    m_i   = 0.2113
    for i in range(len(Limits_HybridNew)):
      m_i   = Limits_HybridNew[i][0]
      lim_i = Limits_HybridNew[i][1]
      if m == m_i:
        return lim_i
      elif m > m_im1 and m < m_i:
        a = (lim_i - lim_im1) / (m_i - m_im1)
        b = (lim_im1*m_i - lim_i*m_im1) / (m_i - m_im1)
        lim = a*m+b
        return lim
      m_im1 = m_i
      lim_im1 = lim_i
  else:
    print "Warning! Mass if outside the range."

# 2015 Granularity
#MGammaD_array = [0.2113,0.2200,0.2300,0.2400,0.2500,0.2600,0.2700,0.2800,0.2900,0.3000,0.3100,0.3200,0.3300,0.3400,0.3500,0.3600,0.3700,0.3800,0.3900,0.4000,0.4100,0.4200,0.4300,0.4400,0.4500,0.4600,0.4700,0.4800,0.4900,0.5000,0.6000,0.7000,0.8000,0.9000,1.0000,1.1000,1.2000,1.5000,2.0000,2.6000,2.7000,2.8000,2.9000,3.0000,3.1000,3.2000,3.3000,3.4000,3.7000,4.0000,5.0000,6.0000,7.0000,8.0000,8.5000]
# 2016 Granularity
MGammaD_array = [0.2113,0.2400,0.2600,0.3000,0.3300,0.3600,0.4000,0.4300,0.4600,0.5000,0.5300,0.5600,0.6000,0.7000,0.8000,0.8800,0.9000,0.9100,0.9200,0.9300,0.9400,1.0000,1.1000,1.2000,1.3000,1.4000,1.5000,1.6000,1.7000,1.8000,1.9000,2.0000,2.1000,2.2000,2.3000,2.4000,2.5000,2.6000,2.7000,2.8000,2.9000,3.0000,3.0200,3.0500,3.0800,3.0900,3.1000,3.1200,3.1500,3.2000,3.3000,3.4000,3.7000,4.0000,5.0000,6.0000,7.0000,8.0000,8.5000]

Limits_HybridNew = [
#OLD COMMAND, 95% v2
[0.2113,3.16974071429],
[0.24,3.15094083333],
[0.26,3.164873125],
[0.3,3.153],
[0.33,3.16802684211],
[0.36,3.160332],
[0.4,3.15017238095],
[0.43,3.15624176471],
[0.46,3.18822352941],
[0.5,3.19246933333],
[0.53,3.26830307692],
[0.56,3.30688692308],
[0.6,3.287213],
[0.7,3.2559525],
[0.8,4.97948647059],
[0.88,3.25090384615],
[0.9,3.17403166667],
[0.91,3.15584090909],
[0.92,3.18351882353],
[0.93,3.18278666667],
[0.94,3.18058473684],
[1.0,3.19010555556],
[1.1,3.18392],
[1.2,3.87639052632],
[1.3,3.3804475],
[1.4,4.97678428571],
[1.5,3.478336],
[1.6,3.21092428571],
[1.7,3.16422214286],
[1.8,3.36318190476],
[1.9,3.78453222222],
[2.0,3.36736],
[2.1,3.204282],
[2.2,3.207873125],
[2.3,3.7348315],
[2.4,4.28794071429],
[2.5,3.33356764706],
[2.6,3.24123583333],
[2.7,3.63779928571],
[2.8,5.0874],
[2.9,5.28966545455],
[3.0,7.00826444444],
[3.02,7.78895363636],
[3.05,8.55555666667],
[3.08,9.152879375],
[3.09,9.190498125],
[3.1,9.15600642857],
[3.12,8.91841666667],
[3.15,8.08752625],
[3.2,6.557825625],
[3.3,5.01724235294],
[3.4,3.26105066667],
[3.7,3.21871333333],
[4.0,3.17041055556],
[5.0,3.19344692308],
[6.0,3.19138307692],
[7.0,3.18332],
[8.0,3.16727705882],
[8.5,3.20162],
#OLD COMMAND, 95%
#[0.2113,3.18711090909],
#[0.24,3.17080875],
#[0.26,3.191005],
#[0.3,3.18464666667],
#[0.33,3.17740571429],
#[0.36,3.16751769231],
#[0.4,3.16378357143],
#[0.43,3.15576076923],
#[0.46,3.18803833333],
#[0.5,3.19889153846],
#[0.53,3.30666],
#[0.56,3.33786461538],
#[0.6,3.2790925],
#[0.7,3.21340714286],
#[0.8,3.17884230769],
#[0.88,3.595456],
#[0.9,4.60707818182],
#[0.91,4.97041444444],
#[0.92,4.98492583333],
#[0.93,4.967793],
#[0.94,4.96643266667],
#[1.0,3.58009545455],
#[1.1,3.21361166667],
#[1.2,4.96460538462],
#[1.3,3.37767571429],
#[1.4,4.97221333333],
#[1.5,3.48148928571],
#[1.6,3.20501705882],
#[1.7,3.17656066667],
#[1.8,5.240896],
#[1.9,5.69242166667],
#[2.0,4.91663066667],
#[2.1,3.22015352941],
#[2.2,3.21622066667],
#[2.3,3.79294083333],
#[2.4,4.42069538462],
#[2.5,3.33645333333],
#[2.6,3.241844375],
#[2.7,3.64634611111],
#[2.8,3.55422071429],
#[2.9,3.40847153846],
#[3.0,4.29388933333],
#[3.02,5.461469],
#[3.05,6.71962428571],
#[3.08,7.5616125],
#[3.09,7.68309785714],
#[3.1,7.69994],
#[3.12,7.60344666667],
#[3.15,6.75310357143],
#[3.2,5.18928],
#[3.3,3.34327666667],
#[3.4,3.198086875],
#[3.7,3.22353857143],
#[4.0,3.21633769231],
#[5.0,3.20173272727],
#[6.0,3.1902],
#[7.0,3.19382833333],
#[8.0,3.21858444444],
#[8.5,3.192591875],
# OLD Command 90% v2
#[0.2113,2.41840272727],
#[0.24,2.4098],
#[0.26,2.37873],
#[0.3,2.39805181818],
#[0.33,2.386414],
#[0.36,2.39501357143],
#[0.4,2.38963857143],
#[0.43,2.38791363636],
#[0.46,2.39813307692],
#[0.5,2.40713636364],
#[0.53,2.48569916667],
#[0.56,2.535485],
#[0.6,2.47376916667],
#[0.7,2.49820933333],
#[0.8,3.43237615385],
#[0.88,2.49236615385],
#[0.9,2.41432],
#[0.91,2.42244428571],
#[0.92,2.4301875],
#[0.93,2.41972],
#[0.94,2.4217],
#[1.0,2.40699375],
#[1.1,2.42197733333],
#[1.2,3.00818846154],
#[1.3,2.57643666667],
#[1.4,3.81116375],
#[1.5,2.65109153846],
#[1.6,2.44415230769],
#[1.7,2.48769928571],
#[1.8,2.587225],
#[1.9,2.89654333333],
#[2.0,2.55023375],
#[2.1,2.42741916667],
#[2.2,2.491577],
#[2.3,2.9049575],
#[2.4,3.32402461538],
#[2.5,2.52599615385],
#[2.6,2.41612866667],
#[2.7,2.776994],
#[2.8,4.05183],
#[2.9,4.291206875],
#[3.0,5.70004904762],
#[3.02,6.45775090909],
#[3.05,7.25778222222],
#[3.08,7.77943363636],
#[3.09,7.83017444444],
#[3.1,7.80179133333],
#[3.12,7.51916636364],
#[3.15,6.74021071429],
#[3.2,5.36172714286],
#[3.3,3.93977875],
#[3.4,2.47325],
#[3.7,2.435594],
#[4.0,2.42748375],
#[5.0,2.42822266667],
#[6.0,2.406383],
#[7.0,2.41992090909],
#[8.0,2.44059333333],
#[8.5,2.4343075],
# OLD Command 90%
#[0.2113,2.39259333333],
#[0.24,2.40394416667],
#[0.26,2.41626466667],
#[0.3,2.405590625],
#[0.33,2.40349222222],
#[0.36,2.427089],
#[0.4,2.37766214286],
#[0.43,2.43332818182],
#[0.46,2.42237055556],
#[0.5,2.43983545455],
#[0.53,2.47509],
#[0.56,2.52729888889],
#[0.6,2.49007],
#[0.7,2.42711],
#[0.8,2.41517166667],
#[0.88,2.752729],
#[0.9,3.293876],
#[0.91,3.80540769231],
#[0.92,3.8300725],
#[0.93,3.84243176471],
#[0.94,3.827598125],
#[1.0,2.70971833333],
#[1.1,2.42197733333],
#[1.2,3.80404833333],
#[1.3,2.56766666667],
#[1.4,3.84863470588],
#[1.5,2.64888785714],
#[1.6,2.45813615385],
#[1.7,2.4482575],
#[1.8,4.223011],
#[1.9,4.57796545455],
#[2.0,3.73501866667],
#[2.1,2.44327666667],
#[2.2,2.41302666667],
#[2.3,2.91800583333],
#[2.4,3.42583636364],
#[2.5,2.50674076923],
#[2.6,2.43614066667],
#[2.7,2.79489210526],
#[2.8,2.72250857143],
#[2.9,2.61171066667],
#[3.0,3.01452857143],
#[3.02,4.28492333333],
#[3.05,5.447268],
#[3.08,6.28408769231],
#[3.09,6.43339722222],
#[3.1,6.42143142857],
#[3.12,6.36106944444],
#[3.15,5.54613571429],
#[3.2,4.209625],
#[3.3,2.52566384615],
#[3.4,2.42880764706],
#[3.7,2.43537083333],
#[4.0,2.42992571429],
#[5.0,2.42496333333],
#[6.0,2.40508133333],
#[7.0,2.443805],
#[8.0,2.421825],
#[8.5,2.42353416667],
# NEW COMMAND
#[0.2113,2.81856235294],
#[0.24,2.81566823529],
#[0.26,2.82365428571],
#[0.3,2.81418384615],
#[0.33,2.81955533333],
#[0.36,2.82122611111],
#[0.4,2.81852333333],
#[0.43,2.81424444444],
#[0.46,2.94057142857],
#[0.5,3.12951117647],
#[0.53,3.5257275],
#[0.56,3.73774066667],
#[0.6,3.56919357143],
#[0.7,2.89429076923],
#[0.8,2.83215461538],
#[0.88,3.99765909091],
#[0.9,4.05799076923],
#[0.91,4.070147],
#[0.92,4.06848625],
#[0.93,4.07959428571],
#[0.94,4.0671375],
#[1.0,3.982102],
#[1.1,3.053819375],
#[1.2,4.10702076923],
#[1.3,3.62756272727],
#[1.4,4.24583923077],
#[1.5,3.80148083333],
#[1.6,3.01001818182],
#[1.7,2.87195583333],
#[1.8,5.36153384615],
#[1.9,5.677206875],
#[2.0,4.25359916667],
#[2.1,2.94262],
#[2.2,2.85667181818],
#[2.3,4.01672714286],
#[2.4,4.05978571429],
#[2.5,3.26026923077],
#[2.6,3.0532],
#[2.7,3.993225],
#[2.8,3.93376384615],
#[2.9,3.400854375],
#[3.0,4.14864714286],
#[3.02,5.33049428571],
#[3.05,6.574294],
#[3.08,7.40944133333],
#[3.09,7.52550222222],
#[3.1,7.548055],
#[3.12,7.38258538462],
#[3.15,6.58318533333],
#[3.2,5.07419181818],
#[3.3,3.22803818182],
#[3.4,2.93016307692],
#[3.7,2.82197666667],
#[4.0,2.82146636364],
#[5.0,2.81569176471],
#[6.0,2.8132125],
#[7.0,2.8204],
#[8.0,2.82356538462],
#[8.5,2.82641785714],
#First time
#[0.2113,2.81306071429],
#[0.24,2.820245],
#[0.26,2.820463],
#[0.3,2.81779285714],
#[0.33,2.82291375],
#[0.36,2.80904],
#[0.4,2.82785777778],
#[0.43,2.82164153846],
#[0.46,2.9524775],
#[0.5,3.12588272727],
#[0.53,3.52600454545],
#[0.56,3.73861181818],
#[0.6,3.56418],
#[0.7,2.90327333333],
#[0.8,2.82875571429],
#[0.88,3.99548642857],
#[0.9,4.06462545455],
#[0.91,4.07220583333],
#[0.92,4.07321428571],
#[0.93,4.0731675],
#[0.94,4.07445],
#[1.0,3.99518],
#[1.1,3.05644875],
#[1.2,4.10662533333],
#[1.3,3.621701],
#[1.4,4.241135],
#[1.5,3.80516545455],
#[1.6,2.99995833333],
#[1.7,2.86616111111],
#[1.8,5.35150384615],
#[1.9,5.68617],
#[2.0,4.24787],
#[2.1,2.941386],
#[2.2,2.85977666667],
#[2.3,4.020795],
#[2.4,4.05932666667],
#[2.5,3.25460222222],
#[2.6,3.054305],
#[2.7,3.99585230769],
#[2.8,3.92714666667],
#[2.9,3.3921175],
#[3.0,4.133965],
#[3.02,5.342161],
#[3.05,6.56383125],
#[3.08,7.40376333333],
#[3.09,7.51519],
#[3.1,7.547794],
#[3.12,7.37887833333],
#[3.15,6.57531],
#[3.2,5.056122],
#[3.3,3.22834666667],
#[3.4,2.92991625],
#[3.7,2.816244],
#[4.0,2.81677071429],
#[5.0,2.81467083333],
#[6.0,2.81401],
#[7.0,2.81587],
#[8.0,2.81585916667],
#[8.5,2.81885125],
]
